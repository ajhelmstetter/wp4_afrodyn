#"mHij" is the matrix containing divergence values between all pairs of samples.
#"datageo" must have columns named "lat" and "lon" with latitude and longitudes
#of samples in degrees decimal, in the same order as for the "mHij" matrix.
#"geodist" is the distance object between individuals of "datageo". If it is
#not given when calling the function, it will be computed from "datageo"
#but this is slower if the function is called repeatedly.
localDiv<-function(latRef,lonRef,Radius,refD=Radius/2,datageo,geodist=NULL,mHij){
if(is.null(geodist)){
print("Compute geodist")
geodist<-as.dist(geod(lon=datageo$lon,lat=datageo$lat))
}
#  dist_to_Ref=sqrt((datageo$lat-lat)^2+(datageo$lon-lon)^2)*40000/360 #distance in km btw Ref coordinate and each sample
#earth great-circle distances of each sample to the ref coordinates
dist_to_Ref <- 6371*acos(sin(latRef*pi/180)*sin(datageo$lat*pi/180)
+ cos(latRef*pi/180)*cos(datageo$lat*pi/180)
* cos(datageo$lon*pi/180-lonRef*pi/180))
keptind=dist_to_Ref<Radius
subsample=sum(keptind) #number of ind within circular window
if(subsample>=3){
subHij=as.dist(mHij[keptind,keptind])
subgeodist=as.dist(as.matrix(geodist)[keptind,keptind])
if(sum(subgeodist>0)>1){
reg<-lm(subHij[subgeodist>0]~log(subgeodist[subgeodist>0]))
HrefD<-reg$coefficients[1]+log(refD)*reg$coefficients[2]
} else HrefD=NA
Hmean<-mean(subHij)
#  plot(x=log(subgeodist),y=subHij)
#  points(y=HrefD,x=log(refD),col="red",cex=2)
NshortD=sum(as.dist(subgeodist)<=refD)
NhighD=sum(as.dist(subgeodist)>refD)
}
else HrefD=Hmean=NshortD=NhighD=NA
if(subsample==2) Hmean=mHij[keptind,keptind][1,2]
output=c(latRef,lonRef,HrefD,Hmean,subsample,NshortD,NhighD,Radius,refD)
names(output)=c("lat","lon","div.refD","div.mean","subsample.size","Npairs.lowerD","Npairs.higherD","Radius(km)","Ref.Dist(km)")
return(output)
}
#example of calling the function "localDiv" to compute local diversity
localDiv(latRef=2,lonRef=13,Radius=100,refD=10,datageo=datageo,geodist=geodist,mHij=mHij)
#Scan local diversity around each node of a lon/lat grid of resolution Dscan in degrees
#NB: lat/lon scan order follows the order implicit in raster object (N->S and W->E)
Div.table=NULL
Dscan=0.5
Radius=100
refD=10
for(lat in Dscan*(ceiling(max(datageo$lat)/Dscan):floor(min(datageo$lat)/Dscan))){
for(lon in Dscan*(floor(min(datageo$lon)/Dscan):ceiling(max(datageo$lon)/Dscan))){
print(c(lat,lon))
div=localDiv(latRef=lat,lonRef=lon,Radius=Radius,refD=refD,datageo=datageo,geodist=geodist,mHij=mHij)
if(is.null(Div.table)) Div.table=div else Div.table<-rbind(Div.table,div)
}
}
row.names(Div.table)<- 1:length(Div.table[,1])
Div.table=as.data.frame(Div.table)
#clean the table to keep only estimates of divergence at ref distance based on interpolation and not extrapolation)
Div.table.cleaned=Div.table
Div.table.cleaned$div.refD[Div.table$Npairs.lowerD==0 | Div.table$Npairs.higherD==0]=NA
#short table limited to cells with estimates of div.mean
Div.table.short=Div.table[!is.na(Div.table$div.mean),]
#Check if estimates depends on sample size within local window
plot(Div.table$subsample.size,Div.table$div.mean,ylim=c(0,1),title(sub=paste("N=", sum(!is.na(Div.table$div.mean))) ) ) #mean divergence
plot(Div.table$subsample.size,Div.table$div.refD,ylim=c(0,1),title(sub=paste("N=", sum(!is.na(Div.table$div.refD))) ) ) #intra+extra-polated divergence
plot(Div.table.cleaned$subsample.size,Div.table.cleaned$div.refD,ylim=c(0,1),title(sub=paste("N=", sum(!is.na(Div.table.cleaned$div.refD))) ) ) #intrapolated divergence
#Compare mean-div with interpolated div
plot(Div.table.cleaned$div.mean,Div.table.cleaned$div.refD,ylim=c(0,1),title(sub=paste("N=", sum(!is.na(Div.table.cleaned$div.refD))) ) ) #intrapolated divergence
#plot raster + data points
library(rgdal)
library(raster)
r.div.refD=r.div.mean <- raster(xmn=min(Div.table$lon)-Dscan/2, xmx=max(Div.table$lon)+Dscan/2,
ymn=min(Div.table$lat)-Dscan/2, ymx=max(Div.table$lat)+Dscan/2,resolution=Dscan)
ncell(r.div.refD)
#plot div for ref Dist
r.div.refD<-setValues(r.div.refD,Div.table.cleaned$div.refD)
plot(r.div.refD,addfun=points(datageo$lon,datageo$lat,cex=0.2))
title(paste("div.refD"),sub=paste0("Radius=",Radius,"km, refD=",refD,"km, ScanResol=",Dscan,"?, Ncells=",sum(!is.na(Div.table.cleaned$div.refD))))
#plot mean divergence
r.div.mean<-setValues(r.div.mean,Div.table$div.mean)
plot(r.div.mean,addfun=points(datageo$lon,datageo$lat,cex=0.2))
setwd("~/Dropbox/projects/AJH_WP4_AFRODYN/")
source("localDiv.r")
#Read in data table
data<-read.table("Distem381ind.txt",header = T,row.names=1)
data
#extract geographic data
#name | lon | lat
datageo<-data[,1:2]
datageo
library(pegas)
library(vcfR)
vcf <- read.vcfR("~/Downloads/anni_filtered.sub2.vcf",checkFile = T, convertNA = T) #read in all data
head(vcf)
vcf
id_ind<-read.csv("ID_index.csv")
vcf <- read.vcfR("~/Downloads/anni_filtered.sub2.vcf",checkFile = T, convertNA = T) #read in all data
head(vcf)
vcf
id_ind<-read.csv("~/Downloads/ID_index.csv")
id_vou<-read.csv("~/Downloads/ID_voucher.csv")
only_seq<-id_vou[id_vou$ID%in%id_ind$ID,]
sort(id_ind$ID)
id_ind[order(id_ind$ID),]
foo<-cbind(only_seq[order(only_seq$ID),],id_ind[order(id_ind$ID),])
sb<-data.frame(as.character(foo$index),as.character(foo$voucher))
colnames(sb)<-c('index','voucher')
sb$index<-as.character(sb$index)
sb$voucher<-as.character(sb$voucher)
sb<-sb[match(sort(sb$index),sb$index),]
sb<-sb[order(sb$index),]
only_seq[order(foo$col),]
sb
id_ind
id_vou
sb
foo
foo[order(foo$index),]
#write.vcf(vcf,"anni_filtered.sub2_written.vcf.gz")
### convert to genlight
aa.genlight <- vcfR2genlight(vcf, n.cores=1)
indNames(aa.genlight)
foo<-foo[order(foo$index),]
indNames(aa.genlight)<-foo$index
#write.vcf(vcf,"anni_filtered.sub2_written.vcf.gz")
### convert to genlight
aa.genlight <- vcfR2genlight(vcf, n.cores=1)
### convert to genlight
dataind <- vcfR2genind(vcf)
#compute genetic distances between individuals for SNP or SSR data (unordered alleles)
Nind=nrow(dataind@tab) #number of individuals
Nloci=length(locNames(dataind)) #number of loci
Hijl<-array(dim=c(Nind,Nind,Nloci)) #array to store inter-individual genetic distances per locus (proportions of non identical pairs of alleles)
for(loc in 1:Nloci){ #loop over loci
tab<-dataind[loc=loc]
Hij=1-crossprod(t(tab@tab))/4  #proportion of non-identical pairs of alleles between diploid individuals
Hij[is.na(Hij)]=mean(as.dist(Hij),na.rm=T) #replace missing values by overall means (between individuals only)
Hijl[,,loc]=Hij
}
mHij=apply(Hijl,FUN="mean",MARGIN=c(1,2)) #pairwise genetic distances between individuals
plot(x=log(geodist),y=as.dist(mHij))
datageo<-data.frame(foo$ddlong,foo$ddlat)
datageo
rownames(datageo)<-foo$index
datageo
colnames(datageo)
colnames(datageo)<-c("lon","lat")
#calculate genetic distances
#great-circle distances (km)
geodist<-as.dist(geod(lon=datageo$lon,lat=datageo$lat))
plot(x=log(geodist),y=as.dist(mHij))
#Regress mHij on log(geodist) to estimate divergence at a given ref distance
refDglobal=1000 #ref distance in km for global divergence
reg<-lm(as.dist(mHij)[geodist>0]~log(geodist[geodist>0]))
Div.global.refD<-reg$coefficients[1]+log(refDglobal)*reg$coefficients[2]
Div.global.refD
#example of calling the function "localDiv" to compute local diversity
localDiv(latRef=2,lonRef=13,Radius=100,refD=10,datageo=datageo,geodist=geodist,mHij=mHij)
#Scan local diversity around each node of a lon/lat grid of resolution Dscan in degrees
#NB: lat/lon scan order follows the order implicit in raster object (N->S and W->E)
Div.table=NULL
Dscan=0.5
Radius=100
refD=10
for(lat in Dscan*(ceiling(max(datageo$lat)/Dscan):floor(min(datageo$lat)/Dscan))){
for(lon in Dscan*(floor(min(datageo$lon)/Dscan):ceiling(max(datageo$lon)/Dscan))){
print(c(lat,lon))
div=localDiv(latRef=lat,lonRef=lon,Radius=Radius,refD=refD,datageo=datageo,geodist=geodist,mHij=mHij)
if(is.null(Div.table)) Div.table=div else Div.table<-rbind(Div.table,div)
}
}
row.names(Div.table)<- 1:length(Div.table[,1])
Div.table=as.data.frame(Div.table)
#clean the table to keep only estimates of divergence at ref distance based on interpolation and not extrapolation)
Div.table.cleaned=Div.table
Div.table.cleaned$div.refD[Div.table$Npairs.lowerD==0 | Div.table$Npairs.higherD==0]=NA
#short table limited to cells with estimates of div.mean
Div.table.short=Div.table[!is.na(Div.table$div.mean),]
#Check if estimates depends on sample size within local window
plot(Div.table$subsample.size,Div.table$div.mean,ylim=c(0,1),title(sub=paste("N=", sum(!is.na(Div.table$div.mean))) ) ) #mean divergence
plot(Div.table$subsample.size,Div.table$div.refD,ylim=c(0,1),title(sub=paste("N=", sum(!is.na(Div.table$div.refD))) ) ) #intra+extra-polated divergence
plot(Div.table.cleaned$subsample.size,Div.table.cleaned$div.refD,ylim=c(0,1),title(sub=paste("N=", sum(!is.na(Div.table.cleaned$div.refD))) ) ) #intrapolated divergence
#Compare mean-div with interpolated div
plot(Div.table.cleaned$div.mean,Div.table.cleaned$div.refD,ylim=c(0,1),title(sub=paste("N=", sum(!is.na(Div.table.cleaned$div.refD))) ) ) #intrapolated divergence
#plot raster + data points
library(rgdal)
library(raster)
r.div.refD=r.div.mean <- raster(xmn=min(Div.table$lon)-Dscan/2, xmx=max(Div.table$lon)+Dscan/2,
ymn=min(Div.table$lat)-Dscan/2, ymx=max(Div.table$lat)+Dscan/2,resolution=Dscan)
ncell(r.div.refD)
#plot div for ref Dist
r.div.refD<-setValues(r.div.refD,Div.table.cleaned$div.refD)
plot(r.div.refD,addfun=points(datageo$lon,datageo$lat,cex=0.2))
title(paste("div.refD"),sub=paste0("Radius=",Radius,"km, refD=",refD,"km, ScanResol=",Dscan,"?, Ncells=",sum(!is.na(Div.table.cleaned$div.refD))))
#plot mean divergence
r.div.mean<-setValues(r.div.mean,Div.table$div.mean)
plot(r.div.mean,addfun=points(datageo$lon,datageo$lat,cex=0.2))
title(paste("div.mean"),sub=paste0("Radius=",Radius,"km, refD=",refD,"km, ScanResol=",Dscan,"?, Ncells=",sum(!is.na(Div.table$div.mean))))
library(maps)
library(plotrix)
library(scales)
library(raster)
?getDAta
uganda <- getData("GADM", level = 0) # level = 1 provides province data
?getData
uganda <- getData("GADM", country='CAM',level = 0) # level = 1 provides province data
uganda <- getData("GADM", country='CMR',level = 0) # level = 1 provides province data
cmr <- getData("GADM", country='CMR',level = 0) # level = 1 provides province data
map('worldhires')
?mapply(function, ...)
?,ap
?map
map('worldhires')
library(mapdata)
install.packages("mapdata")
library(mapdata)
map('worldhires')
map('worldHires')
map('worldHires',xlim = c(-10,30))
map('worldHires',xlim = c(-10,30),ylim=c(-10,20))
map('worldHires',xlim = c(-10,30),ylim=c(-10,30))
map('worldHires',xlim = c(-20,30),ylim=c(-10,30))
map('worldHires',xlim = c(-20,30),ylim=c(-10,40))
map('worldHires',xlim = c(-20,30),ylim=c(-10,30))
points(r.div.mean,addfun=points(datageo$lon,datageo$lat,cex=0.2))
plot(r.div.mean,addfun=points(datageo$lon,datageo$lat,cex=0.2))
?r.div.mean
r.div.mean
?raster
r.div.refD=r.div.mean <- raster(xmn=-3, xmx=31,
ymn=-13, 13,resolution=Dscan)
r.div.refD=r.div.mean <- raster(xmn=-3, xmx=31,
ymn=-13, ymx=13,resolution=Dscan)
r.div.refD=r.div.mean <- raster(xmn=min(Div.table$lon)-Dscan/2, xmx=max(Div.table$lon)+Dscan/2,
ymn=min(Div.table$lat)-Dscan/2, ymx=max(Div.table$lat)+Dscan/2,resolution=Dscan)
ncell(r.div.refD)
r.div.refD=r.div.mean <- raster(xmn=-3, xmx=31,
ymn=-13, ymx=13,resolution=Dscan)
ncell(r.div.refD)
#plot div for ref Dist
r.div.refD<-setValues(r.div.refD,Div.table.cleaned$div.refD)
plot(r.div.refD,addfun=points(datageo$lon,datageo$lat,cex=0.2))
Div.table.cleaned$div.refD
compGen<-function(dataind){
#compute genetic distances between individuals for SNP or SSR data (unordered alleles)
Nind=nrow(dataind@tab) #number of individuals
Nloci=length(locNames(dataind)) #number of loci
Hijl<-array(dim=c(Nind,Nind,Nloci)) #array to store inter-individual genetic distances per locus (proportions of non identical pairs of alleles)
for(loc in 1:Nloci){ #loop over loci
tab<-dataind[loc=loc]
Hij=1-crossprod(t(tab@tab))/4  #proportion of non-identical pairs of alleles between diploid individuals
Hij[is.na(Hij)]=mean(as.dist(Hij),na.rm=T) #replace missing values by overall means (between individuals only)
Hijl[,,loc]=Hij
}
mHij=apply(Hijl,FUN="mean",MARGIN=c(1,2)) #pairwise genetic distances between individuals
plot(x=log(geodist),y=as.dist(mHij))
#Regress mHij on log(geodist) to estimate divergence at a given ref distance
refDglobal=1000 #ref distance in km for global divergence
reg<-lm(as.dist(mHij)[geodist>0]~log(geodist[geodist>0]))
Div.global.refD<-reg$coefficients[1]+log(refDglobal)*reg$coefficients[2]
Div.global.refD
}
compGen(dataind)
scanDiv(Dscan = 0.5, Radius = 100, refD = 10)
##
#Dscan=0.5
#Radius=100
#refD=10
#
#Scan local diversity around each node of a lon/lat grid of resolution Dscan in degrees
#NB: lat/lon scan order follows the order implicit in raster object (N->S and W->E)
scanDiv<-function(Dscan,Radius,refD){
Div.table=NULL
for(lat in Dscan*(ceiling(max(datageo$lat)/Dscan):floor(min(datageo$lat)/Dscan))){
for(lon in Dscan*(floor(min(datageo$lon)/Dscan):ceiling(max(datageo$lon)/Dscan))){
print(c(lat,lon))
div=localDiv(latRef=lat,lonRef=lon,Radius=Radius,refD=refD,datageo=datageo,geodist=geodist,mHij=mHij)
if(is.null(Div.table)) Div.table=div else Div.table<-rbind(Div.table,div)
}
}
row.names(Div.table)<- 1:length(Div.table[,1])
Div.table=as.data.frame(Div.table)
#clean the table to keep only estimates of divergence at ref distance based on interpolation and not extrapolation)
Div.table.cleaned=Div.table
Div.table.cleaned$div.refD[Div.table$Npairs.lowerD==0 | Div.table$Npairs.higherD==0]=NA
#short table limited to cells with estimates of div.mean
Div.table.short=Div.table[!is.na(Div.table$div.mean),]
#Check if estimates depends on sample size within local window
plot(Div.table$subsample.size,Div.table$div.mean,ylim=c(0,1),title(sub=paste("N=", sum(!is.na(Div.table$div.mean))) ) ) #mean divergence
plot(Div.table$subsample.size,Div.table$div.refD,ylim=c(0,1),title(sub=paste("N=", sum(!is.na(Div.table$div.refD))) ) ) #intra+extra-polated divergence
plot(Div.table.cleaned$subsample.size,Div.table.cleaned$div.refD,ylim=c(0,1),title(sub=paste("N=", sum(!is.na(Div.table.cleaned$div.refD))) ) ) #intrapolated divergence
#Compare mean-div with interpolated div
plot(Div.table.cleaned$div.mean,Div.table.cleaned$div.refD,ylim=c(0,1),title(sub=paste("N=", sum(!is.na(Div.table.cleaned$div.refD))) ) ) #intrapolated divergence
}
scanDiv(Dscan = 0.5, Radius = 100, refD = 10)
#example of calling the function "localDiv" to compute local diversity
localDiv(latRef=2,lonRef=13,Radius=50,refD=5,datageo=datageo,geodist=geodist,mHij=mHij)
#scan diversity
scanDiv(Dscan = 0.5, Radius = 50, refD = 5)
r.div.refD=r.div.mean <- raster(xmn=min(Div.table$lon)-Dscan/2, xmx=max(Div.table$lon)+Dscan/2,
ymn=min(Div.table$lat)-Dscan/2, ymx=max(Div.table$lat)+Dscan/2,resolution=Dscan)
ncell(r.div.refD)
#plot div for ref Dist
r.div.refD<-setValues(r.div.refD,Div.table.cleaned$div.refD)
plot(r.div.refD,addfun=points(datageo$lon,datageo$lat,cex=0.2))
title(paste("div.refD"),sub=paste0("Radius=",Radius,"km, refD=",refD,"km, ScanResol=",Dscan,"?, Ncells=",sum(!is.na(Div.table.cleaned$div.refD))))
#plot mean divergence
r.div.mean<-setValues(r.div.mean,Div.table$div.mean)
plot(r.div.mean,addfun=points(datageo$lon,datageo$lat,cex=0.2))
title(paste("div.mean"),sub=paste0("Radius=",Radius,"km, refD=",refD,"km, ScanResol=",Dscan,"?, Ncells=",sum(!is.na(Div.table$div.mean))))
#scan diversity
scanDiv(Dscan = 0.25, Radius = 50, refD = 5)
r.div.refD=r.div.mean <- raster(xmn=min(Div.table$lon)-Dscan/2, xmx=max(Div.table$lon)+Dscan/2,
ymn=min(Div.table$lat)-Dscan/2, ymx=max(Div.table$lat)+Dscan/2,resolution=Dscan)
ncell(r.div.refD)
#plot div for ref Dist
r.div.refD<-setValues(r.div.refD,Div.table.cleaned$div.refD)
plot(r.div.refD,addfun=points(datageo$lon,datageo$lat,cex=0.2))
title(paste("div.refD"),sub=paste0("Radius=",Radius,"km, refD=",refD,"km, ScanResol=",Dscan,"?, Ncells=",sum(!is.na(Div.table.cleaned$div.refD))))
source("localDiv.r")
#example of calling the function "localDiv" to compute local diversity
localDiv(latRef=2,lonRef=13,Radius=50,refD=5,datageo=datageo,geodist=geodist,mHij=mHij)
#scan diversity
scanDiv(Dscan = 0.25, Radius = 50, refD = 5)
#plot raster + data points
library(rgdal)
library(raster)
r.div.refD=r.div.mean <- raster(xmn=min(Div.table$lon)-Dscan/2, xmx=max(Div.table$lon)+Dscan/2,
ymn=min(Div.table$lat)-Dscan/2, ymx=max(Div.table$lat)+Dscan/2,resolution=Dscan)
ncell(r.div.refD)
#plot div for ref Dist
r.div.refD<-setValues(r.div.refD,Div.table.cleaned$div.refD)
plot(r.div.refD,addfun=points(datageo$lon,datageo$lat,cex=0.2))
source("localDiv.r")
#example of calling the function "localDiv" to compute local diversity
localDiv(latRef=2,lonRef=13,Radius=50,refD=5,datageo=datageo,geodist=geodist,mHij=mHij)
#scan diversity
scanDiv(Dscan = 0.25, Radius = 50, refD = 5)
r.div.refD=r.div.mean <- raster(xmn=min(Div.table$lon)-Dscan/2, xmx=max(Div.table$lon)+Dscan/2,
ymn=min(Div.table$lat)-Dscan/2, ymx=max(Div.table$lat)+Dscan/2,resolution=Dscan)
ncell(r.div.refD)
#plot div for ref Dist
r.div.refD<-setValues(r.div.refD,Div.table.cleaned$div.refD)
plot(r.div.refD,addfun=points(datageo$lon,datageo$lat,cex=0.2))
source("localDiv.r")
#compute genetic distances
compGen(dataind,refDglobal = 500)
#example of calling the function "localDiv" to compute local diversity
localDiv(latRef=2,lonRef=13,Radius=50,refD=5,datageo=datageo,geodist=geodist,mHij=mHij)
#scan diversity
scanDiv(Dscan = 0.25, Radius = 50, refD = 5)
r.div.refD=r.div.mean <- raster(xmn=min(Div.table$lon)-Dscan/2, xmx=max(Div.table$lon)+Dscan/2,
ymn=min(Div.table$lat)-Dscan/2, ymx=max(Div.table$lat)+Dscan/2,resolution=Dscan)
ncell(r.div.refD)
Div.table
Div.table$lat
#scan diversity
scanDiv(Dscan = 0.25, Radius = 50, refD = 5)
div
Dscan
#scan diversity
scanDiv(Dscan = 0.25, Radius = 50, refD = 5)
Dscan
unload(Dscan)
rm(list=ls())
setwd("~/Dropbox/projects/AJH_WP4_AFRODYN/")
source("localDiv.r")
id_ind<-read.csv("~/Downloads/ID_index.csv")
id_vou<-read.csv("~/Downloads/ID_voucher.csv")
only_seq<-id_vou[id_vou$ID%in%id_ind$ID,]
sort(id_ind$ID)
id_ind[order(id_ind$ID),]
foo<-cbind(only_seq[order(only_seq$ID),],id_ind[order(id_ind$ID),])
foo<-foo[order(foo$index),]
datageo<-data.frame(foo$ddlong,foo$ddlat)
rownames(datageo)<-foo$index
datageo
colnames(datageo)<-c("lon","lat")
#calculate genetic distances
#great-circle distances (km)
geodist<-as.dist(geod(lon=datageo$lon,lat=datageo$lat))
library(pegas)
library(vcfR)
vcf <- read.vcfR("~/Downloads/anni_filtered.sub2.vcf",checkFile = T, convertNA = T) #read in all data
head(vcf)
vcf
### convert to genlight
dataind <- vcfR2genind(vcf)
#compute genetic distances
compGen(dataind,refDglobal = 500)
#example of calling the function "localDiv" to compute local diversity
localDiv(latRef=2,lonRef=13,Radius=50,refD=5,datageo=datageo,geodist=geodist,mHij=mHij)
#example of calling the function "localDiv" to compute local diversity
localDiv(latRef=2,lonRef=13,Radius=50,refD=5,datageo=datageo,geodist=geodist,mHij=mHij)
#example of calling the function "localDiv" to compute local diversity
localDiv(latRef=2,lonRef=13,Radius=50,refD=5,datageo=datageo,geodist=geodist,mHij=mHij)
source("localDiv.r")
#compute genetic distances
compGen(dataind,refDglobal = 500)
source("localDiv.r")
#compute genetic distances
compGen(dataind,refDglobal = 500)
#compute genetic distances
mHij<-compGen(dataind,refDglobal = 500)
#example of calling the function "localDiv" to compute local diversity
localDiv(latRef=2,lonRef=13,Radius=50,refD=5,datageo=datageo,geodist=geodist,mHij=mHij)
#scan diversity
scanDiv(Dscan = 0.25, Radius = 50, refD = 5)
#plot raster + data points
library(rgdal)
library(raster)
r.div.refD=r.div.mean <- raster(xmn=min(Div.table$lon)-Dscan/2, xmx=max(Div.table$lon)+Dscan/2,
ymn=min(Div.table$lat)-Dscan/2, ymx=max(Div.table$lat)+Dscan/2,resolution=Dscan)
source("localDiv.r")
#scan diversity
Div.table<-scanDiv(Dscan = 0.25, Radius = 50, refD = 5)
r.div.refD=r.div.mean <- raster(xmn=min(Div.table$lon)-Dscan/2, xmx=max(Div.table$lon)+Dscan/2,
ymn=min(Div.table$lat)-Dscan/2, ymx=max(Div.table$lat)+Dscan/2,resolution=Dscan)
Dscan = 0.25
r.div.refD=r.div.mean <- raster(xmn=min(Div.table$lon)-Dscan/2, xmx=max(Div.table$lon)+Dscan/2,
ymn=min(Div.table$lat)-Dscan/2, ymx=max(Div.table$lat)+Dscan/2,resolution=Dscan)
ncell(r.div.refD)
#plot div for ref Dist
r.div.refD<-setValues(r.div.refD,Div.table.cleaned$div.refD)
source("localDiv.r")
#scan diversity
sD<-scanDiv(Dscan = 0.25, Radius = 50, refD = 5)
sD
source("localDiv.r")
#scan diversity
sD<-scanDiv(Dscan = 0.25, Radius = 50, refD = 5)
sD
r.div.refD=r.div.mean <- raster(xmn=min(sD$Div.table$lon)-sD$Dscan/2, xmx=max(sD$Div.table$lon)+sD$Dscan/2,
ymn=min(sD$Div.table$lat)-sD$Dscan/2, ymx=max(sD$Div.table$lat)+sD$Dscan/2,resolution=sD$Dscan)
ncell(r.div.refD)
#plot div for ref Dist
r.div.refD<-setValues(r.div.refD,sD$Div.table.cleaned$div.refD)
plot(r.div.refD,addfun=points(datageo$lon,datageo$lat,cex=0.2))
title(paste("div.refD"),sub=paste0("Radius=",Radius,"km, refD=",refD,"km, ScanResol=",sD$Dscan,"?, Ncells=",sum(!is.na(sD$Div.table.cleaned$div.refD))))
title(paste("div.refD"),sub=paste0("Radius=",sD$Radius,"km, refD=",sD$refD,"km, ScanResol=",sD$Dscan,"?, Ncells=",sum(!is.na(sD$Div.table.cleaned$div.refD))))
#plot mean divergence
r.div.mean<-setValues(r.div.mean,sD$Div.table$div.mean)
plot(r.div.mean,addfun=points(datageo$lon,datageo$lat,cex=0.2))
title(paste("div.mean"),sub=paste0("Radius=",sD$Radius,"km, refD=",sD$refD,"km, ScanResol=",sD$Dscan,"?, Ncells=",sum(!is.na(sD$Div.table$div.mean))))
library(maps)
#compute genetic distances
mHij<-compGen(dataind,refDglobal = 1000)
#example of calling the function "localDiv" to compute local diversity
localDiv(latRef=2,lonRef=13,Radius=200,refD=10,datageo=datageo,geodist=geodist,mHij=mHij)
#scan diversity
sD<-scanDiv(Dscan = 0.5, Radius = 200, refD = 10)
#plot raster + data points
library(rgdal)
library(raster)
r.div.refD=r.div.mean <- raster(xmn=min(sD$Div.table$lon)-sD$Dscan/2, xmx=max(sD$Div.table$lon)+sD$Dscan/2,
ymn=min(sD$Div.table$lat)-sD$Dscan/2, ymx=max(sD$Div.table$lat)+sD$Dscan/2,resolution=sD$Dscan)
ncell(r.div.refD)
#plot div for ref Dist
r.div.refD<-setValues(r.div.refD,sD$Div.table.cleaned$div.refD)
plot(r.div.refD,addfun=points(datageo$lon,datageo$lat,cex=0.2))
title(paste("div.refD"),sub=paste0("Radius=",sD$Radius,"km, refD=",sD$refD,"km, ScanResol=",sD$Dscan,"?, Ncells=",sum(!is.na(sD$Div.table.cleaned$div.refD))))
#plot mean divergence
r.div.mean<-setValues(r.div.mean,sD$Div.table$div.mean)
plot(r.div.mean,addfun=points(datageo$lon,datageo$lat,cex=0.2))
title(paste("div.mean"),sub=paste0("Radius=",sD$Radius,"km, refD=",sD$refD,"km, ScanResol=",sD$Dscan,"?, Ncells=",sum(!is.na(sD$Div.table$div.mean))))
# INTRO
#######
rm(list=ls())
setwd("C:/Users/ah43kg/Dropbox/projects/AJH_austrolebiasCooccurence/")
load("~/Downloads/surface/surfacenichesize.RData")
# probably I load a few libraries too many here
library(surface)
# surface on sizes
###################
#log size
sizes$raw_sl<-log(sizes$raw_sl)
# surface is often not good on a single trait
Adna2<-Adna
Adna2$node.label<-c(1:24)
dnasize<-data.frame(sizes=sizes[sizes$species%in%Adna2$tip.label,2],row.names=sizes[sizes$species%in%Adna2$tip.label,1])
forwd<-runSurface(Adna2,dnasize,sample_shifts=TRUE)
surfaceSummary(forwd[[2]])
Amit2<-Amit
Amit2$node.label<-c(1:24)
BMfit <- fitContinuous(Anuc2, nucsize, model="BM")
BMfit
OUfit <- fitContinuous(Anuc2, nucsize, model="OU")
OUfit
Anuc2<-Anuc
Anuc2$node.label<-c(1:24)
nucsize<-data.frame(sizes[sizes$species%in%Anuc2$tip.label,2],row.names=sizes[sizes$species%in%Anuc2$tip.label,1])
forwn<-runSurface(Anuc2,nucsize,sample_shifts=F,plotaic=T)
surfaceSummary(forwn[[2]])
BMfit <- fitContinuous(Anuc2, nucsize, model="BM")
BMfit
OUfit <- fitContinuous(Anuc2, nucsize, model="OU")
OUfit
fitContinuous()
?fitContinuous()
OUfit <- fitContinuous(Anuc2, nucsize, model="EB")
OUfit
nucsize
names(nucsize)[[1]]
names(nucsize)[1]
rownames(nucsize)
rownames(nucsize)[1]<-"aff"
BMfit <- fitContinuous(Anuc2, nucsize, model="BM")
BMfit
rownames(nucsize)[1]<-"affinis"
BMfit <- fitContinuous(Anuc2, nucsize, model="BM")
BMfit
Anuc2$tip.label
nucsize
?fitContinuous
OUfit
